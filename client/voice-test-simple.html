<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Editor Test - Simple</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white text-center">
                        <h2><i class="fas fa-microphone me-2"></i>Voice Editor Test</h2>
                    </div>
                    <div class="card-body">
                        
                        <!-- Voice Editor Section -->
                        <div class="mb-4 p-4 border rounded" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <h5 class="text-center mb-3">
                                <i class="fas fa-microphone-alt me-2 text-primary"></i>
                                Voice-Driven Resume Editor
                            </h5>
                            
                            <div class="text-center mb-3">
                                <button id="voiceStartBtn" class="btn btn-primary btn-lg me-3">
                                    <i class="fas fa-microphone me-2"></i>
                                    Start Voice Editing
                                </button>
                                <button id="voiceStopBtn" class="btn btn-danger btn-lg" style="display: none;">
                                    <i class="fas fa-stop me-2"></i>
                                    Stop Listening
                                </button>
                            </div>
                            
                            <div id="voiceStatus" class="text-center mb-3">
                                <span class="badge bg-secondary">Ready to listen</span>
                            </div>
                            
                            <div id="commandDisplay" class="alert alert-info" style="display: none;">
                                <h6><i class="fas fa-comment-alt me-2"></i>You're saying:</h6>
                                <div id="commandText" style="font-family: monospace; font-weight: bold;"></div>
                            </div>
                        </div>

                        <!-- Test Form -->
                        <h5 class="mb-3">Test Form (Voice commands will update these fields)</h5>
                        <form>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="fullName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="fullName" name="fullName" placeholder="Say: Update my name to John Smith">
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" name="email" placeholder="Say: Change email to john@example.com">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="phone" class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="Say: Set phone to 555-123-4567">
                                </div>
                                <div class="col-md-6">
                                    <label for="keySkills" class="form-label">Skills</label>
                                    <input type="text" class="form-control" id="keySkills" name="keySkills" placeholder="Say: Add skill JavaScript">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="careerObjective" class="form-label">Career Objective</label>
                                <textarea class="form-control" id="careerObjective" name="careerObjective" rows="3" placeholder="Say: Update my objective to seeking new opportunities"></textarea>
                            </div>
                        </form>
                        
                        <!-- Instructions -->
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-info-circle me-2"></i>How to Test:</h6>
                            <ol>
                                <li>Click "Start Voice Editing"</li>
                                <li>Grant microphone permissions</li>
                                <li>Try these commands:
                                    <ul>
                                        <li>"Update my name to Sarah Johnson"</li>
                                        <li>"Change email to sarah@example.com"</li>
                                        <li>"Add skill Python programming"</li>
                                        <li>"Stop listening"</li>
                                    </ul>
                                </li>
                            </ol>
                            <small><strong>Note:</strong> Works best in Chrome browser</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const voiceBtn = document.getElementById('voiceStartBtn');
            const stopBtn = document.getElementById('voiceStopBtn');
            const statusElement = document.getElementById('voiceStatus');
            const commandDisplay = document.getElementById('commandDisplay');
            const commandText = document.getElementById('commandText');
            
            let recognition = null;
            let isListening = false;
            
            // Check browser support
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                voiceBtn.disabled = true;
                voiceBtn.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>Not Supported';
                statusElement.innerHTML = '<span class="badge bg-danger">Speech recognition not supported in this browser</span>';
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            
            recognition.onstart = function() {
                isListening = true;
                voiceBtn.style.display = 'none';
                stopBtn.style.display = 'inline-block';
                statusElement.innerHTML = '<span class="badge bg-success">üéôÔ∏è Listening...</span>';
                commandDisplay.style.display = 'block';
            };
            
            recognition.onresult = function(event) {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                
                commandText.textContent = transcript;
                
                if (event.results[event.resultIndex].isFinal) {
                    processCommand(transcript.trim());
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                alert('Voice recognition error: ' + event.error);
                stopListening();
            };
            
            recognition.onend = function() {
                if (isListening) {
                    // Restart if we're still supposed to be listening
                    try {
                        recognition.start();
                    } catch (error) {
                        stopListening();
                    }
                }
            };
            
            function startListening() {
                if (!recognition) return;
                
                try {
                    recognition.start();
                } catch (error) {
                    alert('Failed to start voice recognition: ' + error.message);
                }
            }
            
            function stopListening() {
                isListening = false;
                if (recognition) {
                    recognition.stop();
                }
                
                voiceBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
                statusElement.innerHTML = '<span class="badge bg-secondary">Ready to listen</span>';
                commandDisplay.style.display = 'none';
            }
            
            function processCommand(command) {
                console.log('Processing command:', command);
                const lowerCommand = command.toLowerCase().trim();
                
                // Stop commands
                if (lowerCommand.includes('stop') || lowerCommand.includes('stop listening')) {
                    stopListening();
                    showAlert('üõë Voice editing stopped');
                    return;
                }
                
                // Name update - improved pattern matching
                if (lowerCommand.includes('name')) {
                    const patterns = [
                        /(?:update|change|set)\s+(?:my\s+)?name\s+to\s+(.+)/i,
                        /(?:my\s+)?name\s+is\s+(.+)/i,
                        /(?:call\s+me|i'm|i\s+am)\s+(.+)/i
                    ];
                    
                    for (let pattern of patterns) {
                        const match = command.match(pattern);
                        if (match) {
                            const name = match[1].trim();
                            document.getElementById('fullName').value = name;
                            document.getElementById('fullName').dispatchEvent(new Event('input', { bubbles: true }));
                            showAlert('‚úÖ Name updated to: ' + name);
                            return;
                        }
                    }
                }
                
                // Email update - improved pattern matching
                else if (lowerCommand.includes('email')) {
                    const patterns = [
                        /(?:update|change|set)\s+(?:my\s+)?email\s+(?:to\s+|address\s+to\s+)?(.+)/i,
                        /(?:my\s+)?email\s+is\s+(.+)/i,
                        /email\s+(.+)/i
                    ];
                    
                    for (let pattern of patterns) {
                        const match = command.match(pattern);
                        if (match) {
                            const email = match[1].trim();
                            document.getElementById('email').value = email;
                            document.getElementById('email').dispatchEvent(new Event('input', { bubbles: true }));
                            showAlert('‚úÖ Email updated to: ' + email);
                            return;
                        }
                    }
                }
                
                // Phone update - improved pattern matching
                else if (lowerCommand.includes('phone') || lowerCommand.includes('number')) {
                    const patterns = [
                        /(?:update|change|set)\s+(?:my\s+)?(?:phone|number)\s+(?:to\s+)?(.+)/i,
                        /(?:my\s+)?(?:phone|number)\s+is\s+(.+)/i,
                        /(?:phone|number)\s+(.+)/i
                    ];
                    
                    for (let pattern of patterns) {
                        const match = command.match(pattern);
                        if (match) {
                            let phone = match[1].trim();
                            // Convert spoken numbers to digits
                            phone = convertSpokenNumbersToDigits(phone);
                            document.getElementById('phone').value = phone;
                            document.getElementById('phone').dispatchEvent(new Event('input', { bubbles: true }));
                            showAlert('‚úÖ Phone updated to: ' + phone);
                            return;
                        }
                    }
                }
                
                // Skill addition - improved pattern matching
                else if (lowerCommand.includes('skill')) {
                    const patterns = [
                        /add\s+skill\s+(.+)/i,
                        /(?:my\s+)?skill\s+is\s+(.+)/i,
                        /i\s+know\s+(.+)/i,
                        /skilled\s+in\s+(.+)/i
                    ];
                    
                    for (let pattern of patterns) {
                        const match = command.match(pattern);
                        if (match) {
                            const skill = match[1].trim();
                            const skillsField = document.getElementById('keySkills');
                            const currentSkills = skillsField.value.trim();
                            skillsField.value = currentSkills ? currentSkills + ', ' + skill : skill;
                            skillsField.dispatchEvent(new Event('input', { bubbles: true }));
                            showAlert('‚úÖ Added skill: ' + skill);
                            return;
                        }
                    }
                }
                
                // Objective update - improved pattern matching
                else if (lowerCommand.includes('objective') || lowerCommand.includes('summary')) {
                    const patterns = [
                        /(?:update|change|set)\s+(?:my\s+)?(?:objective|summary)\s+to\s+(.+)/i,
                        /(?:my\s+)?(?:objective|summary)\s+is\s+(.+)/i,
                        /(?:objective|summary)\s+(.+)/i
                    ];
                    
                    for (let pattern of patterns) {
                        const match = command.match(pattern);
                        if (match) {
                            const objective = match[1].trim();
                            document.getElementById('careerObjective').value = objective;
                            document.getElementById('careerObjective').dispatchEvent(new Event('input', { bubbles: true }));
                            showAlert('‚úÖ Objective updated');
                            return;
                        }
                    }
                }
                
                else {
                    showAlert('‚ùì Command not recognized. Try: "Update my name to John Smith" or "Add skill JavaScript"');
                    console.log('Unrecognized command:', command);
                }
            }
            
            // Convert spoken numbers to digits
            function convertSpokenNumbersToDigits(text) {
                const numberMap = {
                    'zero': '0', 'one': '1', 'two': '2', 'three': '3', 'four': '4',
                    'five': '5', 'six': '6', 'seven': '7', 'eight': '8', 'nine': '9',
                    'oh': '0'
                };
                
                let result = text;
                for (const [word, digit] of Object.entries(numberMap)) {
                    const regex = new RegExp('\\b' + word + '\\b', 'gi');
                    result = result.replace(regex, digit);
                }
                
                // Remove extra spaces and clean up
                return result.replace(/\s+/g, ' ').trim();
            }
            
            function showAlert(message) {
                // Create temporary alert
                const alert = document.createElement('div');
                alert.className = 'alert alert-success alert-dismissible fade show position-fixed';
                alert.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
                alert.innerHTML = message + '<button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>';
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.remove();
                    }
                }, 3000);
            }
            
            // Event listeners
            voiceBtn.addEventListener('click', startListening);
            stopBtn.addEventListener('click', stopListening);
        });
    </script>
</body>
</html>
